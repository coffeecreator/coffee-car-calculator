<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Coffee-Car · Professionelles Coffee-Catering</title>
<meta name="color-scheme" content="light">
<style>
  :root{
    --mint:#6bd1b3; --mint-2:#39b99a;
    --ink:#0f2722; --ink-70:#40524f;
    --bg:#f7faf9; --card:#ffffff; --muted:#6b7c78;
    --ok:#16794b; --danger:#b02a37;
    --shadow:0 10px 30px rgba(0,0,0,.06);
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  a{color:var(--mint-2);text-decoration:none}
  .wrap{max-width:1000px;margin:0 auto;padding:16px}
  header{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;display:grid;place-items:center;border-radius:50%;background:#fff;box-shadow:var(--shadow)}
  .logo svg{width:40px;height:40px}
  h1{font-size:22px;margin:0}
  small.sub{display:block;color:var(--muted)}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin:14px 0}
  .hero{padding:0;overflow:hidden}
  .hero-img{width:100%;height:260px;background:linear-gradient(120deg,#eaf6f2,#f8fbfa)}
  .hero-caption{display:flex;gap:10px;flex-wrap:wrap;padding:12px}
  .badge{display:inline-flex;align-items:center;gap:8px;background:#eef7f5;border:1px solid #d8efe9;color:var(--ink);padding:8px 12px;border-radius:999px;font-weight:600}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:760px){.grid{grid-template-columns:1fr}}
  label{font-weight:600;font-size:14px;margin-bottom:6px;display:block}
  input,select,textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #d9e7e3;background:#fff;outline:none}
  input:focus,select:focus,textarea:focus{border-color:var(--mint-2);box-shadow:0 0 0 3px rgba(57,185,154,.18)}
  .row{display:flex;flex-wrap:wrap;gap:10px}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #d9e7e3;background:#fff;color:var(--ink-70);font-weight:600}
  .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:700;background:var(--mint-2);color:#fff;cursor:pointer}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .btn-outline{background:#fff;border:1px solid #cfe7e1;color:#1d5a4b}
  .hint{color:var(--muted)}
  .ok{color:var(--ok)} .error{color:var(--danger)}
  .hidden{display:none!important}
  .section-title{font-size:20px;margin:0 0 6px}
  .success{background:#e7f7ef;border:1px solid #cceede;border-radius:12px;padding:12px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo" aria-label="Coffee-Car">
      <svg viewBox="0 0 64 64" fill="none">
        <path d="M8 36c6-14 42-14 48 0" stroke="#39b99a" stroke-width="6" stroke-linecap="round"/>
        <circle cx="14" cy="42" r="4" fill="#39b99a"/><circle cx="50" cy="42" r="4" fill="#39b99a"/>
      </svg>
    </div>
    <div>
      <h1>Coffee-Car</h1>
      <small class="sub">Professionelles Coffee-Catering</small>
    </div>
  </header>

  <section class="card hero" aria-labelledby="heroTitle">
    <div class="hero-img" id="heroImg" role="img" aria-label="Cappuccino mit Latte-Art"></div>
    <div class="hero-caption">
      <span class="badge">Professionelles Coffee-Catering</span>
      <span class="badge">Espresso · Cappuccino · Flat White · u. v. m.</span>
    </div>
  </section>

  <!-- Zusammenfassung -->
  <section class="card">
    <div class="row" style="gap:8px">
      <span class="pill">Termin: <strong id="badgeDate">– bis – (0 Tag/e)</strong></span>
      <span class="pill">Ort: <strong id="badgeCity">–</strong></span>
      <span class="pill">Segment: <strong id="badgeSeg">–</strong></span>
      <span class="pill">Wichtig: <strong id="out_priority">Qualität &amp; Auftritt</strong></span>
      <span class="pill">Verfügbarkeit: <strong id="out_availability">unbekannt</strong> / <span id="out_discount">kein Rabatt</span></span>
      <span class="pill">Preis: <strong id="out_price">–</strong></span>
    </div>
  </section>

  <!-- 1) Termin & Ort -->
  <section class="card" aria-labelledby="s1">
    <h2 id="s1" class="section-title">1) Wann &amp; Wo findet das Event statt?</h2>
    <div class="grid">
      <div>
        <label for="in_date_start">Datum (Start)</label>
        <input id="in_date_start" type="date" required>
      </div>
      <div>
        <label for="in_date_end">Datum (Ende)</label>
        <input id="in_date_end" type="date" required>
        <small class="hint">= Startdatum (automatisch), bei mehrtägigen Events anpassen.</small>
      </div>
      <div>
        <label for="in_city">Ort / PLZ</label>
        <input id="in_city" type="text"
               inputmode="text"
               autocomplete="address-level2 postal-code"
               placeholder="z. B. 71549 Auenwald"
               minlength="2" maxlength="120"
               pattern="[A-Za-zÄÖÜäöüß0-9 .,\-]{2,120}" required>
      </div>
      <div>
        <label for="in_segment">Segment</label>
        <select id="in_segment" required>
          <option value="" disabled selected>Bitte wählen …</option>
          <option>Privat</option>
          <option>Gewerbe</option>
          <option>Agentur</option>
          <option>Kindergarten/Schule</option>
          <option>Behörde/Öffentliche Einrichtung</option>
        </select>
      </div>
    </div>
    <div class="row" style="margin-top:12px">
      <button id="btnCheck" class="btn" type="button">Verfügbarkeit prüfen</button>
    </div>
    <small id="checkMsg" class="hint"></small>
  </section>

  <!-- 6) Angebot sichern -->
  <section class="card" aria-labelledby="s6">
    <h2 id="s6" class="section-title">6) Angebot sichern</h2>
    <p>Wir senden Ihnen das Angebot per E-Mail zu und reservieren den Termin vorläufig.</p>

    <form id="offerForm" novalidate>
      <div class="grid">
        <div>
          <label for="name">Name</label>
          <input id="name" autocomplete="name" placeholder="Ihr Name" required>
        </div>
        <div>
          <label for="email">E-Mail</label>
          <input id="email" type="email" autocomplete="email" placeholder="ihr@mail.de" required>
        </div>
        <div>
          <label for="telefon">Telefon</label>
          <input id="telefon" type="tel" autocomplete="tel" placeholder="+49…">
        </div>
        <div>
          <label for="notes">Hinweise (optional)</label>
          <input id="notes" placeholder="z. B. Aufbauzeit, Wunschgetränke, Logo-Becher …">
        </div>
      </div>

      <div class="row" style="margin:12px 0">
        <label class="row" style="gap:8px;align-items:center">
          <input id="consent" type="checkbox" required>
          <span>Ich stimme der Verarbeitung meiner Angaben zum Zweck der Angebotserstellung zu.</span>
        </label>
      </div>

      <div class="row">
        <button type="submit" class="btn" id="btnSubmit">Angebot sichern</button>
      </div>

      <div id="successBox" class="success hidden" style="margin-top:12px">
        ✅ Danke! Wir melden uns kurzfristig mit einem Angebot.
      </div>
      <div id="errorBox" class="error hidden" style="margin-top:12px"></div>

      <small class="hint">Hinweis: Versand &amp; Protokollierung über Google Apps Script (in deinem Google-Konto). Widerruf jederzeit per E-Mail möglich.</small>
    </form>
  </section>
</div>

<script>
/* ===== Konfiguration ===== */
const GAS_URL = "https://script.google.com/macros/s/AKfycbxczqYTVN1GEcZ6JG-LDe0JsblYg1GtbVMxVPefP5xgXLv-gZ7dHSNarfqi5lljUL7b/exec";

/* ===== Hilfen ===== */
const $ = s => document.querySelector(s);
function fmtCurrency(n){ return new Intl.NumberFormat('de-DE',{style:'currency',currency:'EUR'}).format(n); }
function daysDiff(a,b){ return Math.round((Date.parse(b)-Date.parse(a))/86400000)+1; }
function isoToday(){ const t=new Date(); t.setHours(0,0,0,0); return t.toISOString().slice(0,10); }

/* ===== Datum-Setup (Ende = Start, nie vor Start) ===== */
function setupDates(){
  const start = $('#in_date_start');
  const end   = $('#in_date_end');
  const today = isoToday();

  start.min = today; end.min = today;
  if(!start.value) start.value = today;
  if(!end.value)   end.value   = start.value;

  function syncEnd(){
    end.min = start.value || today;
    if(!end.value || end.value < start.value){ end.value = start.value; }
    updateBadges();
  }
  start.addEventListener('change', syncEnd);
  end.addEventListener('change', ()=>{ if(end.value < start.value) syncEnd(); else updateBadges(); });

  syncEnd();
}

/* ===== Badges aktualisieren ===== */
function updateBadges(){
  const s = $('#in_date_start').value;
  const e = $('#in_date_end').value;
  const d = (s && e) ? daysDiff(s,e) : 0;
  $('#badgeDate').textContent = (s ? s : '–') + ' bis ' + (e ? e : '–') + ' (' + d + ' Tag/e)';
  $('#badgeCity').textContent = $('#in_city').value || '–';
  $('#badgeSeg').textContent  = $('#in_segment').value || '–';
}

/* ===== Demo-Kalkulator ===== */
function calcPrice(){
  const s = $('#in_date_start').value;
  const e = $('#in_date_end').value;
  const days = (s && e) ? daysDiff(s,e) : 1;
  const base = 890; // Tagespreis Demo
  return base * days;
}

/* ===== Verfügbarkeit prüfen ===== */
$('#btnCheck').addEventListener('click', ()=>{
  const s=$('#in_date_start').value, e=$('#in_date_end').value, city=$('#in_city').value.trim(), seg=$('#in_segment').value;
  if(!s || !city || !seg){
    $('#checkMsg').innerHTML = "Bitte Startdatum, Ort und Segment angeben.";
    return;
  }
  // Demo: immer verfügbar + 10% Rabatt
  const price = calcPrice();
  $('#out_availability').textContent = "verfügbar";
  $('#out_discount').textContent = "10% Rabatt";
  $('#out_price').textContent = fmtCurrency(price);
  $('#checkMsg').innerHTML = "✓ Termin <b>"+s+(e&&e!==s?(" bis "+e):"")+"</b> in <b>"+city+"</b> ist voraussichtlich verfügbar. <span class='ok'>10% Rabatt</span> bei schneller Bestätigung.";
  updateBadges();
});

/* ===== Formular senden ===== */
$('#offerForm').addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  $('#errorBox').classList.add('hidden');

  const payload = {
    name: $('#name').value.trim(),
    email: $('#email').value.trim(),
    telefon: $('#telefon').value.trim(),
    consent: $('#consent').checked,
    termin_start: $('#in_date_start').value,
    termin_ende: $('#in_date_end').value,
    ort: $('#in_city').value.trim(),
    segment: $('#in_segment').value,
    wichtig: $('#out_priority').textContent,
    verfuegbarkeit: $('#out_availability').textContent,
    preis_display: $('#out_price').textContent,
    hinweise: $('#notes').value.trim()
  };

  if(!payload.name || !payload.email || !payload.ort){
    return showError("Bitte Name, E-Mail und Ort ausfüllen.");
  }
  if(!payload.consent){
    return showError("Bitte Einverständnis anhaken.");
  }
  if(new Date(payload.termin_start) < new Date(new Date().toDateString())){
    return showError("Das Datum darf nicht in der Vergangenheit liegen.");
  }

  const btn = $('#btnSubmit'); btn.disabled = true;
  try{
    const res = await fetch(GAS_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const json = await res.json().catch(()=>({ok:false,error:"Antwort nicht lesbar"}));
    if(json && json.ok){
      $('#successBox').classList.remove('hidden');
      updateBadges();
      setTimeout(()=>{ document.getElementById('successBox').scrollIntoView({behavior:'smooth'}); }, 80);
    }else{
      throw new Error(json && json.error ? json.error : "Unbekannter Fehler");
    }
  }catch(err){
    showError("Versand fehlgeschlagen: "+String(err).replace(/^Error:\s*/,''));
  }finally{
    btn.disabled = false;
  }
});

function showError(t){ const b=$('#errorBox'); b.textContent=t; b.classList.remove('hidden'); }

/* ===== Ort/Segment Badges live ===== */
$('#in_city').addEventListener('input', updateBadges);
$('#in_segment').addEventListener('change', updateBadges);

/* ===== Start ===== */
window.addEventListener('DOMContentLoaded', ()=>{ setupDates(); updateBadges(); });
</script>
</body>
</html>
